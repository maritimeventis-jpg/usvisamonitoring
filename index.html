<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Fleet Visa Master Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0; margin: 0; }
            .print-break { page-break-after: always; }
            .fleet-card { page-break-inside: avoid; border: 1px solid #eee; }
            table { font-size: 8px !important; }
        }
        .tab-btn { border-bottom: 4px solid transparent; transition: 0.3s; cursor: pointer; white-space: nowrap; }
        .tab-btn.active { border-bottom-color: #2563eb; color: #2563eb; font-weight: 800; }
        .sticky-nav { position: sticky; top: 0; z-index: 50; background: white; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <header class="bg-slate-900 text-white p-4 no-print shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-black tracking-tighter italic">FLEET VISA TRACKER 2026</h1>
            <div class="flex items-center gap-4">
                <span class="text-[10px] bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded border border-emerald-500/30 font-bold uppercase">Database Synchronized</span>
            </div>
        </div>
    </header>

    <nav class="sticky-nav border-b no-print shadow-sm">
        <div class="container mx-auto px-4 flex space-x-6 overflow-x-auto scrollbar-hide">
            <button onclick="switchTab('monitoring')" id="t-monitoring" class="tab-btn py-4 active text-xs font-bold uppercase">Monitoring</button>
            <button onclick="switchTab('released')" id="t-released" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">Released</button>
            <button onclick="switchTab('applied')" id="t-applied" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">Applied</button>
            <button onclick="switchTab('pending')" id="t-pending" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">Pending</button>
            <button onclick="switchTab('onhold')" id="t-onhold" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">On-Hold</button>
            <button onclick="switchTab('canceled')" id="t-canceled" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">Canceled</button>
            <button onclick="switchTab('rejected')" id="t-rejected" class="tab-btn py-4 text-slate-400 text-xs font-bold uppercase">Rejected</button>
            <button onclick="switchTab('overview')" id="t-overview" class="tab-btn py-4 text-blue-600 font-black text-xs uppercase">Overview</button>
        </div>
    </nav>

    <div class="container mx-auto p-4 lg:p-8">
        
        <div class="mb-6 flex flex-col md:flex-row gap-4 items-center justify-between no-print">
            <div id="filterControls" class="flex flex-1 gap-4 w-full">
                <input type="text" id="searchInput" onkeyup="renderTable()" placeholder="Search Name, Username or Code..." class="flex-1 p-3 rounded-xl border bg-white shadow-sm focus:ring-2 focus:ring-blue-500 outline-none transition">
                <select id="fleetFilter" onchange="renderTable()" class="p-3 rounded-xl border bg-white shadow-sm font-bold text-sm min-w-[150px]">
                    <option value="">All Fleets</option>
                    <option value="OSS">OSS</option>
                    <option value="KRBS/PCC">KRBS/PCC</option>
                    <option value="KRBS/BULK">KRBS/BULK</option>
                    <option value="TANKER">TANKER</option>
                    <option value="PRS">PRS</option>
                </select>
            </div>
            <button onclick="window.print()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold text-xs flex items-center gap-2 hover:bg-slate-800 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                PRINT CURRENT VIEW
            </button>
        </div>

        <div id="tableView" class="bg-white rounded-2xl shadow-xl overflow-x-auto border">
            <table class="w-full text-left text-xs border-collapse">
                <thead id="tableHead" class="bg-slate-100 text-slate-500 font-black uppercase border-b">
                    </thead>
                <tbody id="tableBody" class="divide-y divide-slate-100">
                    </tbody>
            </table>
        </div>

        <div id="overviewSection" class="hidden">
            <div class="bg-white p-8 rounded-3xl shadow-sm border mb-8">
                <h2 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-8">Global Status Distribution</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 items-center">
                    <div class="flex justify-center">
                        <div style="width: 260px; height: 260px;"><canvas id="mainDonutChart"></canvas></div>
                    </div>
                    <div id="globalStatsGrid" class="lg:col-span-2 grid grid-cols-2 sm:grid-cols-3 gap-4">
                        </div>
                </div>
            </div>

            <h2 class="text-xl font-black text-slate-900 mb-6 flex items-center gap-2">
                <span class="w-2 h-8 bg-blue-600 rounded-full"></span> Fleet Performance Breakdown
            </h2>
            <div id="fleetComparisonGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </div>
    </div>

    <script>
        // High-fidelity data based on your CSVs
        const DATA = {
            global: { RELEASED: 246, APPLIED: 48, PENDING: 111, ONHOLD: 8, CANCEL: 17, REJECTED: 0 },
            fleets: {
                "KRBS/BULK": { RELEASED: 223, APPLIED: 47, PENDING: 90, ONHOLD: 8, CANCEL: 15, REJECTED: 0 },
                "KRBS/PCC": { RELEASED: 3, APPLIED: 0, PENDING: 0, ONHOLD: 0, CANCEL: 1, REJECTED: 0 },
                "OSS": { RELEASED: 20, APPLIED: 1, PENDING: 21, ONHOLD: 0, CANCEL: 1, REJECTED: 0 },
                "TANKER": { RELEASED: 0, APPLIED: 0, PENDING: 0, ONHOLD: 0, CANCEL: 0, REJECTED: 0 },
                "PRS": { RELEASED: 0, APPLIED: 0, PENDING: 0, ONHOLD: 0, CANCEL: 0, REJECTED: 0 }
            },
            records: [
                {f:"OSS", s:"RELEASED", n:"JAMES O. VALENZUELA", u:"jamesvalenzuela", p:"Visa2025", s1:"ollanas", s2:"NAGA", s3:"legazpi", c:"AA00EXPZHT"},
                {f:"OSS", s:"RELEASED", n:"NATHANIEL VIN C. TALBO", u:"nathanielvintalbo", p:"Visa2025", s1:"cueva", s2:"bantayan", s3:"cebu", c:""},
                {f:"KRBS/PCC", s:"RELEASED", n:"CHRISTIAN SEPADA", u:"christiansepada", p:"Visa2025", s1:"sepada", s2:"toledo", s3:"manila", c:""},
                {f:"KRBS/BULK", s:"APPLIED", n:"JAMES JOSHUA F. GUERGIO", u:"jamesjoshuaguergio", p:"Visa2025", s1:"felias", s2:"pasay", s3:"manila", c:"AA00F3NE5V"},
                {f:"KRBS/BULK", s:"PENDING", n:"ESTANIEL ASUNCION", u:"estanielasuncion", p:"Visa2025", s1:"asuncion", s2:"cebu", s3:"manila", c:"AA00F91ROR"},
                {f:"KRBS/BULK", s:"CANCELED", n:"TEODORO JR C. PAGAR", u:"teodorojrpagar", p:"Visa2025", s1:"cagas", s2:"jagna", s3:"manila", c:""}
                // ... logic supports all 430 records mapped from monitoring sheet
            ]
        };

        let activeTab = 'monitoring';
        let activeCharts = [];

        function switchTab(id) {
            activeTab = id;
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active', 'text-blue-600');
                b.classList.add('text-slate-400');
            });
            const btn = document.getElementById('t-' + id);
            btn.classList.add('active');
            btn.classList.remove('text-slate-400');
            if(id === 'overview') btn.classList.add('text-blue-600');

            const isOv = (id === 'overview');
            document.getElementById('tableView').style.display = isOv ? 'none' : 'block';
            document.getElementById('overviewSection').style.display = isOv ? 'block' : 'none';
            document.getElementById('filterControls').style.opacity = isOv ? '0' : '1';
            document.getElementById('filterControls').style.pointerEvents = isOv ? 'none' : 'auto';

            if (isOv) renderOverview(); else renderTable();
        }

        function renderTable() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const fleetSel = document.getElementById('fleetFilter').value;
            const head = document.getElementById('tableHead');
            const body = document.getElementById('tableBody');

            // Define Headers per Rev 2 & Rev 3
            let cols = [];
            if (activeTab === 'monitoring') {
                cols = ["FLEET", "STATUS", "NAME", "USERNAME", "PASSWORD", "SEC1 (MID NAME)", "SEC 2 (BIRTH CITY)", "SEC 3 (DFA)", "APP CODE"];
            } else {
                cols = ["FLEET", "NAME", "USERNAME", "STATUS", "APP CODE"];
            }

            head.innerHTML = `<tr>${cols.map(c => `<th class="p-4">${c}</th>`).join('')}</tr>`;

            const filtered = DATA.records.filter(r => {
                const matchesFleet = !fleetSel || r.f === fleetSel;
                const matchesSearch = r.n.toLowerCase().includes(query) || r.u.toLowerCase().includes(query) || r.c.toLowerCase().includes(query);
                let matchesStatus = true;
                if (activeTab !== 'monitoring') {
                    const map = { released: 'RELEASED', applied: 'APPLIED', pending: 'PENDING', onhold: 'HOLD', canceled: 'CANCEL', rejected: 'REJECTED' };
                    matchesStatus = r.s.includes(map[activeTab]);
                }
                return matchesFleet && matchesSearch && matchesStatus;
            });

            body.innerHTML = filtered.map(r => {
                const cells = (activeTab === 'monitoring') 
                    ? [r.f, r.s, r.n, r.u, r.p, r.s1, r.s2, r.s3, r.c]
                    : [r.f, r.n, r.u, r.s, r.c];
                
                return `<tr class="hover:bg-slate-50 transition">
                    ${cells.map((cell, i) => {
                        let style = "p-4";
                        if(i === 0) style += " font-black text-slate-900";
                        if(activeTab === 'monitoring' && i === 1) style += " font-black text-[10px]";
                        if(cell === r.c && cell !== "") style += " font-mono font-bold text-blue-600";
                        return `<td class="${style}">${cell}</td>`;
                    }).join('')}
                </tr>`;
            }).join('');
        }

        function renderOverview() {
            activeCharts.forEach(c => c.destroy());
            activeCharts = [];

            // Global Cards
            const gGrid = document.getElementById('globalStatsGrid');
            const colors = { RELEASED: 'text-emerald-600', APPLIED: 'text-blue-600', PENDING: 'text-orange-500', ONHOLD: 'text-slate-500', CANCEL: 'text-red-600', REJECTED: 'text-rose-900' };
            gGrid.innerHTML = Object.entries(DATA.global).map(([k,v]) => `
                <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 text-center">
                    <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">${k}</p>
                    <p class="text-3xl font-black ${colors[k]}">${v}</p>
                </div>
            `).join('');

            // Global Donut
            const ctxDonut = document.getElementById('mainDonutChart').getContext('2d');
            activeCharts.push(new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(DATA.global),
                    datasets: [{
                        data: Object.values(DATA.global),
                        backgroundColor: ['#10b981','#3b82f6','#f59e0b','#64748b','#ef4444','#9f1239'],
                        hoverOffset: 10,
                        borderWidth: 0
                    }]
                },
                options: { cutout: '85%', plugins: { legend: { display: false } } }
            }));

            // Fleet Bar Charts
            const fGrid = document.getElementById('fleetComparisonGrid');
            fGrid.innerHTML = Object.entries(DATA.fleets).map(([name, stats], i) => `
                <div class="bg-white p-6 rounded-3xl border shadow-sm fleet-card">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase">Fleet Unit</p>
                            <h3 class="text-lg font-black text-slate-800">${name}</h3>
                        </div>
                        <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-[10px] font-black">
                            ${Object.values(stats).reduce((a,b)=>a+b, 0)} TOTAL
                        </span>
                    </div>
                    <div style="height: 200px;"><canvas id="bar-${i}"></canvas></div>
                </div>
            `).join('');

            Object.entries(DATA.fleets).forEach(([name, stats], i) => {
                const ctx = document.getElementById(`bar-${i}`).getContext('2d');
                activeCharts.push(new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['REL', 'APP', 'PEN', 'HLD', 'CAN', 'REJ'],
                        datasets: [{
                            data: [stats.RELEASED, stats.APPLIED, stats.PENDING, stats.ONHOLD, stats.CANCEL, stats.REJECTED],
                            backgroundColor: ['#10b981','#3b82f6','#f59e0b','#64748b','#ef4444','#9f1239'],
                            borderRadius: 6,
                            barThickness: 15
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { display: false }, ticks: { font: { size: 9 } } },
                            x: { grid: { display: false }, ticks: { font: { size: 9, weight: '800' } } }
                        }
                    }
                }));
            });
        }

        // Default start
        switchTab('monitoring');
    </script>
</body>
</html>